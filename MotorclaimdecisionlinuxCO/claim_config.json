{
  "version": "1.0",
  "last_updated": "2026-01-06T23:32:11.796675",
  "processing_filters": {
    "only_process_tawuniya": {
      "enabled": true,
      "description": "Only process parties insured with Tawuniya Cooperative Insurance Company. Skip all other parties.",
      "insurance_name_match": "Tawuniya Cooperative Insurance Company",
      "insurance_name_match_arabic": "التعاونية للتأمين"
    }
  },
  "prompts": {
    "main_prompt": "Deterministic enforcement of Tawuniya 29 rules. The post-processing upgrade to ACCEPTED_WITH_SUBROGATION when Liability < 100 is mandatory both in-model and enforced by the system.",
    "compact_prompt_template": "Analyze Party {party_index} for a Tawuniya (The Cooperative) insurance claim decision.\n\nDATA (JSON):\n{data}\n\nMANDATORY INSTRUCTIONS (APPLY EXACTLY):\n1) Use ONLY fields present in the JSON. Do NOT infer or invent facts.\n2) Identify Tawuniya via: party.is_insured_with_cooperative == true OR party.is_cooperative == true OR case-insensitive substring match of party.Insurance_Name against any of: ['tawuniya','cooperative insurance company','the cooperative insurance company','التعاونية للتأمين']. If not Tawuniya -> return decision = \"SKIPPED\" and tawuniya_identified = false.\n3) Normalize party.insurance_type (trim+lower). Treat these as COMPREHENSIVE: ['comprehensive','شامل','co','comp']. If insurance_type missing/empty -> assume comprehensive. If present and not in accepted list -> apply rejection rule 1.\n4) Evaluate the 29 deterministic rejection rules using only fields in the JSON and the detection mapping. Collect ALL matched rule ids (strings) into applied_conditions. If any matched -> decision = \"REJECTED\" and return immediately.\n\nMANDATORY POST-PROCESS RULE (UNAMBIGUOUS):\n- If no rejection rules matched, the model must set decision = \"ACCEPTED\" initially.\n- Immediately AFTER that (before returning JSON) the model MUST perform this check: if party.Liability is present AND numeric AND party.Liability < 100 -> change decision to \"ACCEPTED_WITH_SUBROGATION\" and update classification to 'Accepted with subrogation'.\n- Do NOT return decision = \"ACCEPTED\" when Liability < 100. If Liability is missing or non-numeric, do NOT perform the upgrade and set reasoning to indicate Liability is missing/invalid.\n\nOUTPUT (JSON only, no extra text):\n{{\n  \"party_index\": {party_index},\n  \"party_id\": \"<Party_ID>\",\n  \"tawuniya_identified\": true|false,\n  \"decision\": \"REJECTED | ACCEPTED | ACCEPTED_WITH_SUBROGATION | SKIPPED\",\n  \"reasoning\": \"Very brief reason in English (one sentence, use only JSON fields)\",\n  \"classification\": \"Short label or rules used (e.g., 'Rejected - Rule 1', 'Accepted with subrogation')\",\n  \"applied_conditions\": [\"1\",\"3\",...]\n}}\n\nIMPORTANT: The system also enforces this upgrade in code. If your runtime cannot deterministically apply the upgrade you must NOT claim it was applied. Return only JSON.",
    "translation_prompt": "You are a professional translator specializing in motor vehicle accident reports and insurance claims (LD reports).\n\nTranslate the following Arabic text to English. Maintain technical terms and insurance terminology accurately.\n\nArabic Text:\n{text}\n\nProvide only the English translation, no explanations.",
    "accepted_comprehensive_values": [
      "comprehensive",
      "شامل",
      "co",
      "comp"
    ],
    "tawuniya_name_variants": [
      "tawuniya",
      "cooperative insurance company",
      "the cooperative insurance company",
      "التعاونية للتأمين"
    ],
    "arabic_keywords": {
      "wrong_direction": [
        "عكس السير",
        "سير في الاتجاه المعاكس"
      ],
      "red_light": [
        "اشارة حمراء",
        "تجاوز الإشارة",
        "إشارة حمراء"
      ],
      "sandstorm": [
        "عاصفة رملية",
        "عواصف رملية"
      ],
      "race": [
        "سباق",
        "اختبار سرعة",
        "تجارب سرعة"
      ],
      "stunt": [
        "تفحيط",
        "دريفت",
        "مناورات خطرة"
      ],
      "desert_driving": [
        "صحراء",
        "طرق غير معبدة",
        "طرق ترابية"
      ],
      "fleeing": [
        "هرب",
        "ترك مكان الحادث",
        "الفرار من موقع الحادث"
      ]
    },
    "rejection_rules": [
      {
        "id": "1",
        "short_description": "insurance_type explicitly present and NOT comprehensive",
        "detection_fields": [
          "party.insurance_type"
        ],
        "detection_logic": "Normalize party.insurance_type; if non-empty and not in accepted_comprehensive_values -> match"
      },
      {
        "id": "2",
        "short_description": "party not insured with Tawuniya",
        "detection_fields": [
          "party.is_insured_with_cooperative",
          "party.is_cooperative",
          "party.Insurance_Name"
        ],
        "detection_logic": "If none of Tawuniya identification checks true -> match"
      },
      {
        "id": "3",
        "short_description": "license invalid/suspended/expired and not renewed within 50 days",
        "detection_fields": [
          "party.License_Type_From_Najm",
          "party.License_Expiry_Date",
          "party.License_Renewal_Date",
          "Accident_Date"
        ],
        "detection_logic": "If License_Expiry_Date < Accident_Date and (License_Renewal_Date missing or License_Renewal_Date > Accident_Date + 50 days) -> match. Also if explicit field 'license_invalid' true -> match."
      },
      {
        "id": "4",
        "short_description": "wrong direction driving",
        "detection_fields": [
          "accident_description",
          "party.wrong_direction_flag"
        ],
        "detection_logic": "If party.wrong_direction_flag true OR accident_description contains any arabic_keywords.wrong_direction -> match"
      },
      {
        "id": "5",
        "short_description": "running red light",
        "detection_fields": [
          "accident_description",
          "party.red_light_flag"
        ],
        "detection_logic": "If party.red_light_flag true OR accident_description contains any arabic_keywords.red_light -> match"
      },
      {
        "id": "6",
        "short_description": "repair without Tawuniya approval",
        "detection_fields": [
          "party.repair_without_approval_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "7",
        "short_description": "driver not owner, not relative, not sponsored",
        "detection_fields": [
          "party.Party_Name",
          "party.Policyholdername",
          "party.sponsorship_flag"
        ],
        "detection_logic": "If sponsorship_flag false/missing AND driver name tokens do not match owner name tokens (compare second/last names where available) -> match"
      },
      {
        "id": "8",
        "short_description": "manufacturing defect or mechanical fault",
        "detection_fields": [
          "party.manufacturing_defect_flag",
          "accident_description"
        ],
        "detection_logic": "If explicit flag true or description indicates mechanical failure -> match"
      },
      {
        "id": "9",
        "short_description": "overloading/excessive strain",
        "detection_fields": [
          "party.overloading_flag",
          "accident_description"
        ],
        "detection_logic": "If explicit flag true or description indicates overload -> match"
      },
      {
        "id": "10",
        "short_description": "tires/rims/hubcaps/mirrors only",
        "detection_fields": [
          "party.damage_parts",
          "accident_description"
        ],
        "detection_logic": "If damage limited to those parts and not lost at collision -> match"
      },
      {
        "id": "11",
        "short_description": "damage to goods/personal belongings",
        "detection_fields": [
          "party.goods_damage_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "12",
        "short_description": "damage to a trailer",
        "detection_fields": [
          "party.trailer_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "13",
        "short_description": "theft where vehicle left running/unlocked",
        "detection_fields": [
          "party.theft_left_running_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "14",
        "short_description": "sandstorm damage",
        "detection_fields": [
          "party.sandstorm_flag",
          "accident_description"
        ],
        "detection_logic": "If sandstorm_flag true OR accident_description contains any arabic_keywords.sandstorm -> match"
      },
      {
        "id": "15",
        "short_description": "use contrary to policy usage restrictions",
        "detection_fields": [
          "party.policy_usage_violation_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "16",
        "short_description": "excess passengers/cargo",
        "detection_fields": [
          "party.excess_passengers_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "17",
        "short_description": "vehicle used in races/speed tests",
        "detection_fields": [
          "party.race_flag",
          "accident_description"
        ],
        "detection_logic": "If race_flag true OR description contains any arabic_keywords.race -> match"
      },
      {
        "id": "18",
        "short_description": "driving under influence",
        "detection_fields": [
          "party.dui_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "19",
        "short_description": "use in areas prohibited to public",
        "detection_fields": [
          "party.prohibited_area_flag",
          "accident_description"
        ],
        "detection_logic": "If prohibited_area_flag true OR description indicates airports/ports -> match"
      },
      {
        "id": "20",
        "short_description": "operating as a work machine excluded",
        "detection_fields": [
          "party.work_machine_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "21",
        "short_description": "stunt driving/drifting or red light or wrong direction exclusions",
        "detection_fields": [
          "party.stunt_flag",
          "accident_description"
        ],
        "detection_logic": "If stunt_flag true OR description matches stunt/red_light/wrong_direction keywords -> match"
      },
      {
        "id": "22",
        "short_description": "criminal or hostile acts by driver",
        "detection_fields": [
          "party.criminal_act_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "23",
        "short_description": "driver intentionally exposed vehicle to danger",
        "detection_fields": [
          "party.intentional_exposure_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "24",
        "short_description": "driving in deserts/unpaved roads outside city excluded",
        "detection_fields": [
          "party.desert_driving_flag",
          "accident_description"
        ],
        "detection_logic": "If desert_driving_flag true OR description contains arabic_keywords.desert_driving -> match"
      },
      {
        "id": "25",
        "short_description": "failure to comply with traffic regulations",
        "detection_fields": [
          "party.traffic_violation_flag",
          "accident_description"
        ],
        "detection_logic": "If explicit flag true or description indicates violations -> match"
      },
      {
        "id": "26",
        "short_description": "use conflicting with Kingdom laws/regulations",
        "detection_fields": [
          "party.legal_conflict_flag"
        ],
        "detection_logic": "If explicit flag true -> match"
      },
      {
        "id": "27",
        "short_description": "accident > 90 days before Upload_Date/current date",
        "detection_fields": [
          "Accident_Date",
          "Upload_Date"
        ],
        "detection_logic": "If Upload_Date present and (Upload_Date - Accident_Date) > 90 days OR if Upload_Date missing and (current_date - Accident_Date) > 90 days -> match"
      },
      {
        "id": "28",
        "short_description": "fraud suspected/identified",
        "detection_fields": [
          "Suspect_as_Fraud",
          "party.fraud_flag"
        ],
        "detection_logic": "If Suspect_as_Fraud == true OR party.fraud_flag true -> match"
      },
      {
        "id": "29",
        "short_description": "vehicle owner mismatch (insured owner differs from report)",
        "detection_fields": [
          "party.VehicleOwnerId",
          "party.Policyholder_ID",
          "party.Policyholdername"
        ],
        "detection_logic": "If VehicleOwnerId != Policyholder_ID OR owner name tokens mismatch -> match"
      }
    ],
    "decision_post_processing": {
      "note": "Do not perform any inference. If a check cannot be performed because a field is missing, do not apply that rule.",
      "if_no_rejection_then": "ACCEPTED",
      "if_accepted_and_liability_lt_100_then": "ACCEPTED_WITH_SUBROGATION"
    }
  },
  "rules": {
    "basic_rules": {
      "rule_1_100_percent_liability": {
        "id": "BR1",
        "enabled": true,
        "description": "If party.Liability == 100% -> REJECTED (highest priority).",
        "note": "This is an overriding top-level rule. Evaluate first.",
        "applies_to": "all_companies"
      },
      "rule_2_non_cooperative_0_25_50_75": {
        "enabled": true,
        "description": "If non-cooperative + liability in [0,25,50,75]% → ACCEPTED (unless rejection condition applies)",
        "applies_to": "non_tawuniya"
      },
      "rule_3_cooperative_responsible_party_not_cooperative": {
        "enabled": true,
        "description": "If cooperative + liability<100% + responsible party (100%) not cooperative → REJECTED",
        "applies_to": "tawuniya"
      },
      "rule_4_cooperative_responsible_party_cooperative": {
        "enabled": true,
        "description": "If cooperative + liability<100% + responsible party (100%) cooperative → ACCEPTED",
        "applies_to": "tawuniya"
      },
      "rule_5_zero_liability_non_cooperative": {
        "enabled": true,
        "description": "If liability=0% + non-cooperative → ACCEPTED",
        "applies_to": "non_tawuniya"
      },
      "rule_6_zero_liability_cooperative_responsible_not_cooperative": {
        "enabled": true,
        "description": "If liability=0% + cooperative + responsible party not cooperative → REJECTED",
        "applies_to": "tawuniya"
      }
    },
    "rejection_rules": [
      {
        "id": "1",
        "enabled": true,
        "description": "If party.insurance_type is explicitly present and is NOT comprehensive (not in accepted_comprehensive_values). If insurance_type is empty or missing, assume comprehensive (do NOT trigger).",
        "detection": "normalize party.insurance_type; if non-empty and not in accepted_comprehensive_values -> match"
      },
      {
        "id": "2",
        "enabled": true,
        "description": "If the PARTY is NOT insured with The Cooperative Insurance Company (Tawuniya).",
        "detection": "if none of tawuniya booleans true AND Insurance_Name does not contain any tawuniya_name_variants -> match",
        "detection_hint": "If none of the tawuniya_name_variants present and boolean flags false/missing -> matches."
      },
      {
        "id": "3",
        "enabled": true,
        "description": "Vehicle driven without valid license for the vehicle type, or license suspended, or License_Expiry_Date < Accident_Date and not renewed within 50 days from Accident_Date.",
        "detection": "if License_Expiry_Date < Accident_Date and (License_Renewal_Date missing or License_Renewal_Date > Accident_Date + 50 days) OR explicit license_invalid flag true -> match"
      },
      {
        "id": "4",
        "enabled": true,
        "description": "Driving in the wrong direction (against traffic).",
        "detection": "party.wrong_direction_flag true OR accident_description contains any arabic_keywords.wrong_direction -> match"
      },
      {
        "id": "5",
        "enabled": true,
        "description": "Running a red light.",
        "detection": "party.red_light_flag true OR accident_description contains any arabic_keywords.red_light -> match"
      },
      {
        "id": "6",
        "enabled": true,
        "description": "Repairing the vehicle without obtaining prior approval from The Cooperative Insurance Company.",
        "detection": "party.repair_without_approval_flag true -> match"
      },
      {
        "id": "7",
        "enabled": true,
        "description": "Driver does not own the vehicle and is not a relative (father, mother, son, daughter, brother, sister) and not under sponsorship of the vehicle owner.",
        "detection": "if sponsorship_flag false/missing AND driver second/last name tokens do not match owner name tokens -> match (if insufficient name tokens do NOT apply)",
        "detection_hint": "Use token matching on second/last names when available; if insufficient data do not apply."
      },
      {
        "id": "8",
        "enabled": true,
        "description": "Accident caused by manufacturing defects in the vehicle or mechanical/electrical faults.",
        "detection": "party.manufacturing_defect_flag true OR accident_description indicates mechanical failure -> match"
      },
      {
        "id": "9",
        "enabled": true,
        "description": "Damage resulted from overloading or excessive strain.",
        "detection": "party.overloading_flag true OR accident_description indicates overload -> match"
      },
      {
        "id": "10",
        "enabled": true,
        "description": "Damage, loss, or theft limited to tires, rims, hubcaps, or external mirrors, unless they were lost at the time of the accident.",
        "detection": "party.damage_parts indicates only these parts AND not lost_at_collision -> match"
      },
      {
        "id": "11",
        "enabled": true,
        "description": "Losses or damages to goods or personal belongings during transportation or loading/unloading (not covered).",
        "detection": "party.goods_damage_flag true -> match"
      },
      {
        "id": "12",
        "enabled": true,
        "description": "Damage to a trailer is not covered.",
        "detection": "party.trailer_flag true -> match"
      },
      {
        "id": "13",
        "enabled": true,
        "description": "The policy does not cover theft/attempted theft if the vehicle was left running or unlocked.",
        "detection": "party.theft_left_running_flag true -> match"
      },
      {
        "id": "14",
        "enabled": true,
        "description": "Damages from sandstorms are not covered.",
        "detection": "party.sandstorm_flag true OR accident_description contains any arabic_keywords.sandstorm -> match"
      },
      {
        "id": "15",
        "enabled": true,
        "description": "Usage in violation of the usage restrictions stated in the policy.",
        "detection": "party.policy_usage_violation_flag true -> match"
      },
      {
        "id": "16",
        "enabled": true,
        "description": "Increase in the number of passengers or cargo beyond the permitted amount voids compensation.",
        "detection": "party.excess_passengers_flag true -> match"
      },
      {
        "id": "17",
        "enabled": true,
        "description": "Using the vehicle in races or speed tests is not covered.",
        "detection": "party.race_flag true OR accident_description contains any arabic_keywords.race -> match"
      },
      {
        "id": "18",
        "enabled": true,
        "description": "No coverage when driving under the influence of drugs, alcohol, or medication that prohibits driving.",
        "detection": "party.dui_flag true -> match"
      },
      {
        "id": "19",
        "enabled": true,
        "description": "Use in areas prohibited to the public (airports, ports) is not covered.",
        "detection": "party.prohibited_area_flag true OR accident_description indicates airports/ports -> match"
      },
      {
        "id": "20",
        "enabled": true,
        "description": "Operating the vehicle as a work machine is excluded from coverage.",
        "detection": "party.work_machine_flag true -> match"
      },
      {
        "id": "21",
        "enabled": true,
        "description": "Accidents resulting from stunt driving (drifting), running a red light, or driving in the wrong direction are not covered.",
        "detection": "party.stunt_flag true OR accident_description contains any stunt/red_light/wrong_direction keywords -> match"
      },
      {
        "id": "22",
        "enabled": true,
        "description": "Criminal or hostile acts by the driver nullify liability or expenses.",
        "detection": "party.criminal_act_flag true -> match"
      },
      {
        "id": "23",
        "enabled": true,
        "description": "Driver intentionally exposing the vehicle to danger voids coverage.",
        "detection": "party.intentional_exposure_flag true -> match"
      },
      {
        "id": "24",
        "enabled": true,
        "description": "Driving the vehicle in deserts or unpaved roads outside the city is not covered.",
        "detection": "party.desert_driving_flag true OR accident_description contains any arabic_keywords.desert_driving -> match"
      },
      {
        "id": "25",
        "enabled": true,
        "description": "Failure to comply with traffic regulations and instructions voids coverage.",
        "detection": "party.traffic_violation_flag true OR accident_description indicates violations -> match"
      },
      {
        "id": "26",
        "enabled": true,
        "description": "If the vehicle was used in activities that conflict with the laws and regulations in force in the Kingdom.",
        "detection": "party.legal_conflict_flag true -> match"
      },
      {
        "id": "27",
        "enabled": true,
        "description": "If the accident occurred more than 90 days before Upload_Date (or current date if Upload_Date missing).",
        "detection": "if Upload_Date present and (Upload_Date - Accident_Date) > 90 days OR if missing and (current_date - Accident_Date) > 90 days -> match"
      },
      {
        "id": "28",
        "enabled": true,
        "description": "In case of fraud by the parties involved in the accident.",
        "detection": "Suspect_as_Fraud == true OR party.fraud_flag true -> match"
      },
      {
        "id": "29",
        "enabled": true,
        "description": "If the owner of the vehicle insured with The Cooperative differs from the one stated in the report (VehicleOwnerId vs Policyholder_ID or owner name mismatch).",
        "detection": "VehicleOwnerId != Policyholder_ID OR owner name token mismatch -> match"
      }
    ],
    "rejection_conditions": {
      "condition_2_tawuniya_sum_zero": {
        "enabled": true,
        "description": "Sum liability for Tawuniya parties = 0"
      },
      "condition_3_damaged_vehicle_owned_by_at_fault": {
        "enabled": true,
        "description": "Damaged vehicle owned by at-fault party"
      },
      "condition_4_property_of_insured": {
        "enabled": true,
        "description": "Property of insured/under management"
      },
      "condition_5_death_of_insured_driver": {
        "enabled": true,
        "description": "Death of insured/driver"
      },
      "condition_6_racing_testing": {
        "enabled": true,
        "description": "Racing/testing"
      },
      "condition_7_prohibited_area": {
        "enabled": true,
        "description": "Prohibited area"
      },
      "condition_8_intentional_damage": {
        "enabled": true,
        "description": "Intentional damage"
      },
      "condition_9_collusion_staged": {
        "enabled": true,
        "description": "Collusion/staged"
      },
      "condition_10_intentional_accident": {
        "enabled": true,
        "description": "Intentional accident"
      },
      "condition_11_fleeing_scene": {
        "enabled": true,
        "description": "Fleeing scene"
      },
      "condition_12_reckless_driving": {
        "enabled": true,
        "description": "Reckless driving"
      },
      "condition_13_drugs_alcohol": {
        "enabled": true,
        "description": "Drugs/alcohol"
      },
      "condition_14_natural_disasters": {
        "enabled": true,
        "description": "Natural disasters"
      },
      "condition_15_failure_to_notify": {
        "enabled": true,
        "description": "Failure to notify"
      },
      "condition_16_more_than_5_years": {
        "enabled": true,
        "description": "More than 5 years passed"
      },
      "condition_17_fraud": {
        "enabled": true,
        "description": "Fraud exists"
      }
    },
    "recovery_conditions": {
      "condition_1_wrong_way_driving": {
        "enabled": true,
        "description": "Wrong-way driving"
      },
      "condition_2_red_light_violation": {
        "enabled": true,
        "description": "Red light violation"
      },
      "condition_3_exceeding_capacity": {
        "enabled": true,
        "description": "Exceeding capacity"
      },
      "condition_4_stolen_vehicle": {
        "enabled": true,
        "description": "Stolen vehicle"
      },
      "condition_5_license_expired": {
        "enabled": true,
        "description": "License_Expiry_Date < Accident_Date"
      },
      "condition_6_license_type_mismatch": {
        "enabled": true,
        "description": "License type mismatch"
      }
    },
    "accepted_comprehensive_values": [
      "comprehensive",
      "شامل",
      "co",
      "comp"
    ],
    "arabic_keywords": {
      "wrong_direction": [
        "عكس السير",
        "سير في الاتجاه المعاكس"
      ],
      "red_light": [
        "اشارة حمراء",
        "تجاوز الإشارة",
        "إشارة حمراء"
      ],
      "sandstorm": [
        "عاصفة رملية",
        "عواصف رملية"
      ],
      "race": [
        "سباق",
        "اختبار سرعة",
        "تجارب سرعة"
      ],
      "stunt": [
        "تفحيط",
        "دريفت",
        "مناورات خطرة"
      ],
      "desert_driving": [
        "صحراء",
        "طرق غير معبدة",
        "طرق ترابية"
      ],
      "fleeing": [
        "هرب",
        "ترك مكان الحادث",
        "الفرار من موقع الحادث"
      ]
    },
    "tawuniya_name_variants": [
      "tawuniya",
      "tawuniya cooperative insurance company",
      "the cooperative insurance company",
      "التعاونية للتأمين"
    ],
    "decision_logic": {
      "evaluation_order": [
        "BR1 (liability==100) - if true -> REJECTED",
        "Then evaluate rules 1..29 deterministically and collect all matches",
        "If any rule 1..29 matched -> REJECTED",
        "Else -> ACCEPTED",
        "If ACCEPTED AND party.Liability < 100 -> change to ACCEPTED_WITH_SUBROGATION"
      ],
      "output_fields": [
        "party_index",
        "party_id",
        "decision",
        "reasoning",
        "classification",
        "applied_conditions (array of strings, e.g., [\"1\",\"3\"])",
        "tawuniya_identified (true|false)"
      ],
      "post_decision_outputs": {
        "REJECTED": "Return decision=REJECTED and applied_conditions = list of matched rule numbers (as strings). classification should include 'Rejected - rules [...]' and a brief reasoning (English).",
        "ACCEPTED": "Return decision=ACCEPTED and applied_conditions = []. If Liability < 100 -> decision should be ACCEPTED_WITH_SUBROGATION."
      }
    },
    "post_rules": {
      "if_any_rejection_matched": "decision = REJECTED; applied_conditions = list of matched rule ids as strings",
      "if_no_rejection_matched": "decision = ACCEPTED; then MANDATORY upgrade: if party.Liability < 100 -> decision = ACCEPTED_WITH_SUBROGATION"
    }
  },
  "response_fields": {
    "enabled_fields": {
      "Party": true,
      "Party_ID": true,
      "Party_Name": true,
      "Liability": true,
      "Decision": true,
      "Classification": true,
      "Reasoning": true,
      "Applied_Conditions": true,
      "isDAA": true,
      "Suspect_as_Fraud": true,
      "DaaReasonEnglish": true,
      "Policyholder_ID": true,
      "Policyholdername": true,
      "Suspected_Fraud": true,
      "model_recovery": true,
      "License_Type_From_Make_Model": true
    },
    "description": {
      "Party": "Party identifier",
      "Party_ID": "Party ID from request",
      "Party_Name": "Party name from request",
      "Liability": "Liability percentage",
      "Decision": "Decision (ACCEPTED/REJECTED/ACCEPTED_WITH_RECOVERY)",
      "Classification": "Rule/condition used for decision",
      "Reasoning": "Brief explanation in English",
      "Applied_Conditions": "List of condition numbers that applied",
      "isDAA": "DAA flag from request",
      "Suspect_as_Fraud": "Suspect as fraud flag from request",
      "DaaReasonEnglish": "DAA reason in English from request",
      "Policyholder_ID": "Policyholder ID from request",
      "Party_Name": "Party name from request",
      "Suspected_Fraud": "Suspected fraud flag (calculated: 'Suspected Fraud' if isDAA=TRUE, else null)",
      "model_recovery": "Model recovery flag (calculated based on license type mismatch)",
      "License_Type_From_Make_Model": "License type from make/model lookup"
    }
  },
  "implementation_notes": {
    "deterministic_only": "All checks must use only provided JSON fields. If a required field for a rule is missing, that rule cannot be applied (do not infer).",
    "string_matching": "Use case-insensitive substring matching for Insurance_Name against tawuniya_name_variants.",
    "relative_detection": "For rule 7 use second and last name tokens to identify relatives; if tokens missing, do not apply rule deterministically.",
    "insurance_type_handling": "Normalize party.insurance_type using accepted_comprehensive_values; empty/missing => treat as comprehensive.",
    "date_handling": "Use Accident_Date and Upload_Date for date arithmetic. If Upload_Date missing, use current date provided at runtime."
  },
  "metadata": {
    "name": "Tawuniya 29-rule detection mapping",
    "version": "2026-01-06",
    "description": "Deterministic implementation of the business 29 rejection rules for Tawuniya (The Cooperative). If none of the 29 rejection rules applies then the claim is ACCEPTED. If accepted and Liability < 100% then the claim is ACCEPTED_WITH_SUBROGATION. Always use only fields present in the JSON input; do not infer facts.",
    "note": "Deterministic detection hints for each rejection rule. Use only provided JSON fields; do not infer."
  }
}
